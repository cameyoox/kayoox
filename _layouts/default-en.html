<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,maximum-scale=2">
    <link rel="stylesheet" type="text/css" media="screen" href="{{ '/assets/css/style.css?v=' | append: site.github.build_revision | relative_url }}">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.lazyload/1.9.1/jquery.lazyload.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>

{% if page.datatable == true %}
    
    <!-- Include the standard DataTables bits -->
    <link rel="stylesheet" type="text/css" href="//cdn.datatables.net/1.10.13/css/jquery.dataTables.css">
    <script type="text/javascript" charset="utf8" src="//cdn.datatables.net/1.10.13/js/jquery.dataTables.js"></script>
    <!-- First, this walks through the tables that occur between ...-begin
         and ...-end and add the "datatable" class to them.
         Then it invokes DataTable's standard initializer
         Credit here: http://www.beardedhacker.com/blog/2015/08/28/add-class-attribute-to-markdown-table/
      -->
    <script>
      $(document).ready(function() {
          $('div.datatable-begin').nextUntil('div.datatable-end', 'table').addClass('display');
          
          var table = $('table.display').DataTable( {
              ajax: '/assets/data/data-uk.txt',
              paging: true,
              stateSave: true,
              searching: true,
              drawCallback: function() {
                $("img.lazy").lazyload();
              },
              "createdRow": function ( row, data, index ) {
                $(row).addClass("pointer");
              },
              columnDefs: [
                {
                  targets:  [0],
                  visible: false,
                  orderable: false,
                  searchable: false
                },
                {
                    targets: [1],
                    orderable: false,
                    searchable: false,
                    render: function(data, type, full, meta) {
                      if (data != "") {
                        return "<img class='lazy' data-original='https://www.yoox.com/images/items/11/" + data + "_14_f.jpg?width=90&height=115&impolicy=crop&gravity=Center' width='90' height='115'/>"  
                      }
                      return ""
                    },
                    createdCell: function (td, cellData, rowData, row, col) {
                      $(td).attr('style', 'text-align: left;');
                    }
                }, 
                {
                 targets: [2], 
                 orderable: false,
                 searchable: true,
                 createdCell: function (td, cellData, rowData, row, col) {
                      $(td).attr('data-label', 'Brand');
                    }
                },
                {
                 targets: [3], 
                 orderable: false,
                 searchable: true,
                 createdCell: function (td, cellData, rowData, row, col) {
                      $(td).attr('data-label', 'Category');
                    }
                },
                {
                 targets: [4], 
                 orderable: false,
                 searchable: true,
                 createdCell: function (td, cellData, rowData, row, col) {
                      $(td).attr('data-label', 'Size');
                    }
                },
                {
                  targets: [5],
                  orderable: false,
                  render: function(data, type, full, meta) {
                      if (data != "") {
                        colourContent = "<span class='text-center'>"

                        colours = data.split(",")
                        colours = colours.map(parseColour)
                        colourContent = colourContent.concat(colours.join(""))
                        colourContent = colourContent.concat("</span>")

                        return colourContent
                      }
                      return "<span class='text-center'>"+parseColour('rgba(0, 0, 0, 0)')+"</span>"
                    },
                  createdCell: function (td, cellData, rowData, row, col) {
                      $(td).attr('data-label', 'Colours');
                    }  
                },
                {
                  targets: [6],
                  searchable: false,
                  render: $.fn.dataTable.render.number( '.', ',', 2, '£' ),
                  createdCell: function (td, cellData, rowData, row, col) {
                      $(td).attr('data-label', 'Current price');
                    }
                },
                {
                  targets: [7],
                  searchable: false,
                  render: $.fn.dataTable.render.number( '.', ',', 2, '£' ),
                  createdCell: function (td, cellData, rowData, row, col) {
                      $(td).attr('data-label', 'Max. price');
                    }
                },
                {
                  targets: [8],
                  searchable: false,
                  render: $.fn.dataTable.render.number( '.', ',', 2, '£' ),
                  createdCell: function (td, cellData, rowData, row, col) {
                      $(td).attr('data-label', 'Min. price');
                    }
                },
                {
                  targets: [9],
                  searchable: false,
                  render: $.fn.dataTable.render.number( '.', ',', 2, '£' ),
                  createdCell: function (td, cellData, rowData, row, col) {
                      $(td).attr('data-label', 'Current discount');
                    }
                }
              ],
              initComplete: function () {

                var columns_process = [2,3,4]
                
                this.api().columns().every( function () {

                    var column = this;
                    
                    if (columns_process.includes(column.index())) { 
                      var columnId = "column" + column.index()

                      if(column.index() != 4) {
                        var availableTags = []

                        column.data().unique().sort().each( function ( d, j ) {
                            availableTags.push( d )
                        } );

                        availableTags.sort();
                      } else {
                        availableTags = ["1", "1.5","2","2.5","3","3.5","4","4.5","5","5.5", "6", "6.5","7","7.5","8","8.5","9","9.5","10", "10.5", "11"];
                      }
                      
                      $( "#"+ columnId ).autocomplete({
                            source: availableTags,
                            select: function(e, ui) {
                                
                                if ( column.search() !== ui.item.value ) {
                                  searchTerm = ui.item.value;
                                  
                                  if(column.index() == 4) {
                                      searchTerm = ui.item.value + "(?![^ ])";      
                                  }
                                  
                                  column
                                    .search( searchTerm , true, false)
                                    .draw();
                              }
                          }
                      });

                      $( "#"+ columnId ).on('search', function () {
                        if ( column.search() !== this.value ) {
                          column
                              .search( this.value )
                              .draw();
                        }
                      }); 
                    }
                  });  
                }
              });
            
              $('#example tbody').on('click', 'tr', function () {
                var data = table.row( this ).data();
                window.open('product.html?product=' + data[0] 
                                      + '&brand=' + data[2] 
                                      + '&category=' + data[3]
                                      + '&price=' + data[6]
                                      + '&maxprice=' + data[7]
                                      + '&minprice=' + data[8]
                                      ,'_blank');
              });

              function parseColour(value, index, array) {
                  return "<span class='color-circle' style='background-color:  " + value + "'></span>"
              }
       });
    </script>
{% endif %}

{% seo %}

{% include analytics.html %}
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer" onclick="location.href='https://www.cameyoox.com';">
        <header class="inner">
          <h1 id="project_title">{{ site.title }}</h1>
          <h2 id="project_tagline">{{ page.description }}</h2>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        {{ content }}
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">{{ site.title }}</p>
      </footer>
    </div>

    {% if site.google_analytics %}
      <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', '{{ site.google_analytics }}', 'auto');
        ga('send', 'pageview');
      </script>
    {% endif %}
  </body>
</html>